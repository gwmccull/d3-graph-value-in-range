<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
</head>
<body>
<svg id="graph-value-range" width="480" height="100" viewBox="0 0 1000 200" preserveAspectRatio="xMinYMin"></svg>

<script type="application/javascript">
    var ticks = [{
        value: 1,
        type: 'major'
    }, {
        value: 2,
        type: 'minor'
    }, {
        value: 3,
        type: 'minor'
    }, {
        value: 4,
        type: 'minor'
    }, {
        value: 5,
        type: 'major'
    }];

    var marker = {};
    marker.width = 30;
    marker.height = 30;
    marker.totalHeight = marker.height;

    var tick = {};
    tick.major = {};
    tick.major.height = 40;
    tick.minor = {};
    tick.minor.height = 20;
    tick.lineWidth = 8;

    var graph = {};
    graph.totalWidth = 1000;
    graph.width = graph.totalWidth - marker.width;
    graph.markerCount = ticks.length;

    tick.increment = graph.width / (graph.markerCount - 1); // distance between the center of each tick

    var svg = d3.select('#graph-value-range');

    init();

    // generate a valid value on the scale, rounded to the tenths place
    // re-render the graph with that value
    setInterval(function() {
        var score = Math.round((Math.random() * (ticks.length - 1) + 1) * 10) / 10;
        renderMarker([score]);
    }, 1000);

    function init() {
        renderGraph();
        renderMarker([1]);
    }

    function renderGraph() {
        var valueRange = svg.append('g')
                .attr('id', 'value-range')
                .attr('transform', 'translate(' + 0 + ',' + 0 + ')');

        for (var ii = 1; ii < ticks.length; ii++) {
            valueRange.append('line')
                    .data([ii])
                    .attr('class', 'base-line')
                    .attr('y1', 0)
                    .attr('y2', 0)
                    .attr('x1', wrapCalcPosition.call(this, 0))
                    .attr('x2', wrapCalcPosition.call(this, 1))
                    .attr('stroke', wrapGetColor.call(this, 0.5))
                    .attr('stroke-width', tick.lineWidth)
                    .attr('transform', 'translate(0,' + (tick.major.height - (tick.lineWidth / 2)) + ')');
        }

        valueRange.selectAll('.label')
                .data(ticks)
                .enter()
                .append('line')
                .attr('class', 'tick')
                .attr('y1', function(d) {
                    return tick.major.height - tick[d.type].height;
                })
                .attr('y2', tick.major.height)
                .attr('x1', calcPosition)
                .attr('x2', calcPosition)
                .attr('stroke', getColor)
                .attr('stroke-width', tick.lineWidth);

        valueRange.selectAll('.label')
                .data(ticks)
                .enter()
                .append('text')
                .attr('class', 'label')
                .attr('y', tick.major.height * 2)
                .attr('x', calcPosition)
                .attr('text-anchor', 'middle')
                .attr('font-size', '40px')
                .attr('fill', getColor)
                .text(function(d) {
                    return d.value;
                })

    }

    function renderMarker(value) {
        svg.select('#marker').remove();

        svg.append('polygon')
                .data(value)
                .attr('id', 'marker')
                .attr('points', (marker.width / 2 * -1) + ',0 ' + (marker.width / 2) + ',0 ' + 0 + ',' + marker.height)
                .attr('fill', function(d) {
                    return getColor({
                        value: d
                    })
                })
                .attr('transform', function(d) {
                    return 'translate(' + calcPosition({value: d}) + ',' + (tick.major.height - marker.height - tick.lineWidth) + ')';
                })
    }

    function calcPosition(d) {
        return (tick.increment * (d.value - 1)) + (marker.width / 2);
    }

    function wrapCalcPosition(increment) {
        return function(d) {
            return calcPosition({
                value: d + increment
            });
        };
    }

    function getColor(d) {
        var color;
        if (d.value < 2) {
            color = 'blue';
        } else if (d.value <= 4) {
            color = 'purple';
        } else{
            color = 'red';
        }

        return color;
    }

    function wrapGetColor(increment) {
        return function(d) {
            return getColor({
                value: d + increment
            });
        };
    }

</script>
</body>
</html>